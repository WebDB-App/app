@if (selectedServer && selectedDatabase) {
	<mat-toolbar
		class="spaceBetweenCenter"
		style="padding: 20px">
		<div>
			<span style="vertical-align: middle;">
				Database: {{ selectedDatabase!.name }}
			</span>
		</div>
		<button (click)="drop()" color="warn" mat-button>
			<span class="material-symbols-outlined notranslate">
				dangerous
			</span>
			Drop
		</button>
	</mat-toolbar>
	<div id="content">
		<ngx-monaco-editor
			(onInit)="initEditor($event)"
			[(ngModel)]="str"
			[options]="editorOptions"
			cdkFocusInitial
		></ngx-monaco-editor>
		<mat-divider></mat-divider>
		@if (stats) {
			<div class="spaceBetweenCenter">
				<span>Total Index Size : {{ +stats.index_length | round }} Mb</span>
				<span>Total Data Size : {{ +stats.data_length | round }} Mb</span>
			</div>
		}
		@if (selectedServer?.wrapper === 'MySQL') {
			<mat-divider></mat-divider>
			<div class="spaceBetweenCenter">
				<mat-form-field color="accent">
					<mat-label>Collation</mat-label>
					<mat-select #collation [value]="selectedDatabase!.collation">
						@for (collation of collations; track collation) {
							<mat-option
								[value]="collation">{{ collation }}
							</mat-option>
						}
					</mat-select>
				</mat-form-field>
				@if (changeColLoading) {
					<mat-spinner
						[diameter]="30"
						color="primary"
					></mat-spinner>
				}
				@if (!changeColLoading) {
					<button
						(click)="changeCollation(collation.value)"
						[disabled]="!collation.value"
						color="accent"
						mat-stroked-button>
						<span class="material-symbols-outlined notranslate">
							glyphs
						</span>
						Convert entire database
					</button>
				}
			</div>
		}
		<mat-divider></mat-divider>
		<div class="spaceBetweenCenter">
			@if (selectedServer.driver.terminalCmd()) {
				<button
					(click)="snackBar.open('Command copied', '⨉', {duration: 3000})"
					[cdkCopyToClipboard]="selectedServer.driver.terminalCmd()"
					mat-button>
					<span class="material-symbols-outlined notranslate">
						terminal
					</span>
					CLI
				</button>
			}
			<button
				(click)="snackBar.open('URI copied', '⨉', {duration: 3000})"
				[cdkCopyToClipboard]="selectedServer.uri!"
				mat-button>
				<span class="material-symbols-outlined notranslate">
					link
				</span>
				URI
			</button>
		</div>
		<mat-divider></mat-divider>
		<div class="spaceBetweenCenter">
			<mat-form-field>
				<mat-label>Copy Name</mat-label>
				<input
					#dbCopy
					[value]="selectedDatabase!.name.split(' | ')[0]"
					autocomplete="off"
					matInput>
			</mat-form-field>
			@if (duplicateLoading) {
				<mat-spinner
					[diameter]="30"
					color="primary"
				></mat-spinner>
			}
			@if (!duplicateLoading) {
				<button
					(click)="duplicate(dbCopy.value)"
					[disabled]="!nameValid(dbCopy.value)"
					mat-stroked-button>
					<span class="material-symbols-outlined notranslate">
						folder_copy
					</span>
					Duplicate Database
					@if (dbCopy.value !== selectedDatabase!.name.split(' | ')[0] && !nameValid(dbCopy.value)) {
						<mat-error>
							Name already taken or containing special characters
						</mat-error>
					}
				</button>
			}
		</div>
		<mat-accordion style="padding: 20px; display: block;">
			<mat-expansion-panel>
				<mat-expansion-panel-header>
					<mat-panel-title>
						<span class="material-symbols-outlined notranslate">
							speed
						</span>
					</mat-panel-title>
					<mat-panel-description>
						Performance Tips
					</mat-panel-description>
				</mat-expansion-panel-header>
				• If you do >10req/sec, use unix socket or try to reduce network latency
				<br>
				• Check resource (CPU, RAM, Disk I/O) usage of the server and allocate more
				<br>
				• Use cloud hosted databases if you don't have time dedicated to infrastructure
				<br>
				• Use the assistant for more advanced optimizations of the database structure or the server tuning
				<br>
				• Sharding, load balancing and replication can help but are not simple to implement and maintain
				<br>
			</mat-expansion-panel>
			<mat-expansion-panel>
				<mat-expansion-panel-header>
					<mat-panel-title>
						<span class="material-symbols-outlined notranslate">
							health_and_safety
						</span>
					</mat-panel-title>
					<mat-panel-description>
						Security Tips
					</mat-panel-description>
				</mat-expansion-panel-header>
				• Avoid exposing database to public network, prefer SSH tunnel
				<br>
				• Do regular backup of your database to an external provider
				<br>
				• Follow the data rules apply (personal data encryption, strong password encryption with salt, etc)
				<br>
			</mat-expansion-panel>
		</mat-accordion>
	</div>
}
